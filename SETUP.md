# Ick — Go-Live Checklist

Everything in this file requires your action. Code is ready. These are external services, keys, and store submissions.

---

## 1. Required env vars (Render dashboard)

Go to your service → **Environment** → add each variable.

| Variable | Where to get it | Required? |
|---|---|---|
| `JWT_SECRET` | Auto-generated by render.yaml | ✅ |
| `REFRESH_SECRET` | Auto-generated by render.yaml | ✅ |
| `RESEND_API_KEY` | resend.com → API Keys | ✅ email |
| `EMAIL_FROM` | `Ick <hello@ick.app>` | ✅ email |
| `OPENAI_API_KEY` | platform.openai.com | ✅ receipts |
| `ADMIN_BOOTSTRAP_SECRET` | Make up a strong password | ✅ first deploy |
| `STRIPE_SECRET_KEY` | dashboard.stripe.com → Developers → API Keys | ✅ billing |
| `STRIPE_WEBHOOK_SECRET` | Stripe → Webhooks → your endpoint | ✅ billing |
| `STRIPE_MONTHLY_PRICE_ID` | Stripe → Products → Monthly price | ✅ billing |
| `STRIPE_YEARLY_PRICE_ID` | Stripe → Products → Yearly price | ✅ billing |
| `PREMIUM_ENABLED` | Set to `true` when ready to charge | billing |
| `USDA_API_KEY` | fdc.nal.usda.gov/api-key-signup (free) | optional |
| `FATSECRET_CLIENT_ID` | platform.fatsecret.com (free) | optional |
| `FATSECRET_CLIENT_SECRET` | Same | optional |
| `VAPID_PUBLIC_KEY` | Generate (see below) | optional push |
| `VAPID_PRIVATE_KEY` | Generate (see below) | optional push |
| `FIREBASE_SERVICE_ACCOUNT_BASE64` | Firebase console → Service Accounts | optional push |

**Generate VAPID keys:**
```bash
node -e "const wp=require('web-push'); console.log(JSON.stringify(wp.generateVAPIDKeys()))"
```

---

## 2. Stripe setup (step by step)

1. Create account at [stripe.com](https://stripe.com)
2. Go to **Products** → Create product "Ick Premium"
3. Add two prices:
   - Monthly: $4.99/month recurring → copy `price_xxx`
   - Yearly: $39.99/year recurring → copy `price_xxx`
4. Go to **Developers → Webhooks** → Add endpoint:
   - URL: `https://your-app.onrender.com/api/subscription/webhook`
   - Events to listen for:
     - `checkout.session.completed`
     - `invoice.paid`
     - `customer.subscription.deleted`
     - `invoice.payment_failed`
5. Copy the webhook signing secret (`whsec_xxx`)
6. Paste all four values into Render env vars
7. Set `PREMIUM_ENABLED=true` when ready to go live

---

## 3. Bootstrap your admin account

After first deploy:
1. Register a normal account in the app
2. Make a POST request to `/api/auth/bootstrap-admin`:
   ```bash
   curl -X POST https://your-app.onrender.com/api/auth/bootstrap-admin \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"bootstrap_secret": "YOUR_ADMIN_BOOTSTRAP_SECRET"}'
   ```
3. You can now access `/admin` in the app
4. From there you can promote other admins, grant trials, review contributions

---

## 4. Seed the product database

The DB auto-seeds harmful ingredients + recipes on first deploy.

For actual food products (850K+), run the bulk importer from the Render shell:

```bash
# In Render dashboard → your service → Shell
cd /opt/render/project/src/backend
DATABASE_URL=$DATABASE_URL node src/db/import-off-bulk.js
```

This downloads the Open Food Facts dump (~2-3GB), filters US products, and imports them. Takes 30-60 minutes. Run once, then re-run monthly to catch new products.

After import, run auto-flag from the Admin panel (Products tab → Auto-Flag Clean Alternatives, score ≥ 75) to populate swap suggestions.

---

## 5. Resend email setup

1. Sign up at [resend.com](https://resend.com) (free: 3,000 emails/month)
2. Go to **Domains** → Add your domain (e.g. `ick.app`)
3. Add the DNS records they give you (MX, TXT, DKIM)
4. Wait for verification (usually < 1 hour)
5. Go to **API Keys** → Create key → paste into `RESEND_API_KEY`
6. Set `EMAIL_FROM=Ick <hello@ick.app>`

To test without a domain: use `onboarding@resend.dev` as `EMAIL_FROM` and it'll work on the free sandbox.

---

## 6. App Store submission (iOS)

Capacitor is fully configured. You need:

**Prerequisites:**
- Apple Developer account ($99/year) at [developer.apple.com](https://developer.apple.com)
- Mac with Xcode installed
- App icons (already in `frontend/public/icons/` — export to required sizes)

**Steps:**
```bash
# Build frontend
cd frontend && npm run build && cd ..

# Copy to Capacitor
npx cap sync ios

# Open in Xcode
npx cap open ios
```

In Xcode:
1. Set Bundle ID to `com.ick.app` (or your chosen ID)
2. Set version number
3. Select your Apple Developer team
4. Product → Archive
5. Distribute App → App Store Connect

**Required before submission:**
- [ ] Privacy Policy URL (e.g. `ick.app/privacy`)
- [ ] App screenshots (6.7" iPhone required, iPad optional)
- [ ] App description (max 4,000 chars)
- [ ] Keywords
- [ ] Age rating (likely 4+ or 9+)
- [ ] Review the [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/) — especially around subscriptions (must show price, must have restore purchases)

**Subscription requirements (Apple):**
- Add "Restore Purchases" button in Subscription page
- Show price clearly before purchase
- Must have account deletion (✅ already built)

---

## 7. Play Store submission (Android)

**Prerequisites:**
- Google Play Developer account ($25 one-time) at [play.google.com/console](https://play.google.com/console)
- Android Studio installed (for signing)

**Steps:**
```bash
# Build frontend
cd frontend && npm run build && cd ..

# Copy to Capacitor
npx cap sync android

# Open in Android Studio
npx cap open android
```

In Android Studio:
1. Build → Generate Signed Bundle/APK → Android App Bundle
2. Create a keystore (save it somewhere safe — you can never change it)
3. Upload the `.aab` file to Play Console

**Required before submission:**
- [ ] Privacy Policy URL
- [ ] App screenshots (phone required, tablet optional)
- [ ] Feature graphic (1024×500px)
- [ ] Content rating questionnaire
- [ ] Data safety form (describe what data you collect)

---

## 8. FatSecret Premier Free (better barcode data)

The free basic tier is fine but doesn't include barcode lookups or images. Premier Free is free for startups — just email their team:

1. Sign up for basic at [platform.fatsecret.com](https://platform.fatsecret.com)
2. Email `api@fatsecret.com` — mention you're a startup, ask for Premier Free access
3. Once approved, your existing credentials will unlock barcode + image endpoints
4. Add `FATSECRET_CLIENT_ID` and `FATSECRET_CLIENT_SECRET` to Render env vars

---

## 9. USDA production API key

The `DEMO_KEY` is limited to 30 req/hr which will hit limits quickly.

1. Go to [fdc.nal.usda.gov/api-key-signup](https://fdc.nal.usda.gov/api-key-signup/)
2. Fill out the form (free, instant)
3. Replace `DEMO_KEY` with your key in Render env vars

Production key gives 1,000 req/hr.
